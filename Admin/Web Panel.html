<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="icon" href="https://i.ibb.co/0jQ5z5L/favicon.png" type="image/x-icon" />
    <link rel="shortcut icon" href="https://i.ibb.co/0jQ5z5L/favicon.png" type="image/x-icon" />
    <style>
        *{
            box-sizing: border-box;
            font-family: "roboto", sans-serif;
        }
        
        body {
            font-family: "roboto", sans-serif;
            font-size: 17px;
            padding: 8px;
            background-image: url("https://thompsonfamilyhealthcare.com/wp-content/uploads/2019/08/Fitness-Coach.jpg");
        }
        
        .container {
            width: 50%;
            margin: auto;
            background-color: #006685;
            padding: 5px 20px 15px;
            border: 2px solid lightgray;
            border-radius: 8px;
        }

        h2 {
            text-align: center;
            color: #FFFFFF;
            font-weight: 700;
        }
        
        input[type=text] {
            width: 100%;
            margin-bottom: 20px;
            padding: 12px;
            border: 1px solid #FFFFFF;
            border-radius: 8px;
        }

        input[type=file] {
            width: 100%;
            margin-bottom: 20px;
            padding: 12px;
            border: 1px solid #FFFFFF;
            border-radius: 8px;
            color: #FFFFFF;
        }

        textarea {
            width: 100%;
            margin-bottom: 20px;
            padding: 12px;
            border: 1px solid #000000;
            border-radius: 8px;
        }

        select {
            width: 100%;
            margin-bottom: 20px;
            padding: 12px;
            border: 1px solid #FFFFFF;
            border-radius: 8px;
        }
        
        label {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
            
        }
        
        .icon-container {
            margin-bottom: 20px;
            padding: 7px 0;
            font-size: 24px;
        }

        .btn-clear {
            background-color: #FFFFFF;
            color:red;
            padding: 8px;
            margin-bottom: 20px;
            border: 2px solid #FFFFFF;
            border-radius: 30px;
            width: 100px;
            cursor: pointer;
            font-size: 17px;
            font-weight: 700;
            box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
        }

        .btn-clear:hover {
            background-color: red;
            color: #FFFFFF;
            box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
        }
        
        .btn-addexercise {
            background-color: #FFFFFF;
            color:#006685;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #FFFFFF;
            border-radius: 30px;
            width: 100%;
            cursor: pointer;
            font-size: 17px;
            font-weight: 700;
            box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
            display: block;
        }
        
        .btn-addexercise:hover {
            background-color: #006685;
            color: #FFFFFF;
            box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
        }

        .spin-holedr {
            background-color: #FFFFFF;
            color:#006685;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #FFFFFF;
            border-radius: 30px;
            width: 100%;
            box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
            display: none;
        }

        .spin-holedr p {
            color: #006685;
            font-weight: 700;
            margin: 4px 0 0 0;
        }
        
        .loader {
            border: 6px solid #D9D9D9; 
            border-top: 6px solid #006685;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            animation: spin 1s linear infinite;
            margin: auto;
            display: none; 
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <title>Smart Personal Coach</title>
</head>
<body>
    <div class="container">
        <form id="addExercise" method="post">
                <!-- Title -->
                <h2>Add Exercises To Smart Personal Coach</h2> 

                <!-- Collection name -->
                <label for="collectionName"><i class="fa-solid fa-book-bookmark"></i> Collection Name</label>
                <select id="collectionName" name="collectionName" required>
                    <option value="abs_exercises">abs_exercises</option>
                    <option value="arms_exercises">arms_exercises</option>
                    <option value="back_exercises">back_exercises</option>
                    <option value="chest_exercises">chest_exercises</option>
                    <option value="legs_exercises">legs_exercises</option>
                </select>

                <!-- Document name -->
                <label for="docName"><i class="fa-solid fa-file"></i> Document Name</label>
                <input type="text" id="docName" name="docName" placeholder="ex: push_ups" required>

                <!-- Name of the exercise -->
                <label for="name"><i class="fa-solid fa-dumbbell"></i> Name Of The Exercise</label>
                <input type="text" id="name" name="name" placeholder="ex: Push Ups" required>

                <!-- Introduction -->
                <label for="introduction"><i class="fa-solid fa-pen"></i> Introduction</label>
                <textarea id="introduction" name="introduction" placeholder="Write something.." required></textarea>

                <!-- Difficulty -->
                <label for="difficulty"><i class="fa-solid fa-person-walking"></i> Difficulty</label>
                <select id="difficulty" name="difficulty" required>
                    <option value="Easy">Easy</option>
                    <option value="Moderate">Moderate</option>
                    <option value="Challenging">Challenging</option>
                </select>

                <!-- Steps 1-->
                <label for="step1"><i class="fa-solid fa-pen"></i> Step 1</label>
                <textarea id="step1" name="step1" placeholder="Write something.." required></textarea>

                <!-- Steps 2-->
                <label for="step2"><i class="fa-solid fa-pen"></i> Step 2</label>
                <textarea id="step2" name="step2" placeholder="Write something.." required></textarea>

                <!-- Steps 3-->
                <label for="step3"><i class="fa-solid fa-pen"></i> Step 3</label>
                <textarea id="step3" name="step3" placeholder="Write something.." required></textarea>

                <!-- Steps 4-->
                <label for="step4"><i class="fa-solid fa-pen"></i> Step 4</label>
                <textarea id="step4" name="step4" placeholder="Write something.." required></textarea>

                <!-- Common Mistakes -->
                <label for="commonMistakes"><i class="fa-solid fa-pen"></i> Common Mistakes When Performing The Exercise</label>
                <textarea id="commonMistakes" name="commonMistakes" placeholder="Write something.." required></textarea>

                <!-- Animation Image -->
                <label for="animationImageFile"><i class="fa-solid fa-image"></i> Animation Image ( .GIF )</label>
                <input type="file" id="animationImageFile" name="animationImageFile" accept="image/*" required>

                <!-- Muscles Worked Image -->
                <label for="musclesWorkedImageFile"><i class="fa-solid fa-image"></i> Muscles Worked Image ( .JPG )</label>
                <input type="file" id="musclesWorkedImageFile" name="musclesWorkedImageFile" accept="image/*" required>

                <!-- Admin Key -->
                <!-- <label for="adminKey" style="color: #FFFFFF; font-weight: 600; margin-bottom: 10px; display: block; font-size: 14px;"><i class="fa-solid fa fa-key" style="font-size: 12px;"></i> Enter The Admin Key To Proceed!</label>
                <input type="password" id="adminKey" name="adminKey" placeholder="********" required> -->

                <!-- Clear button -->
                <div style="text-align: right;"><button type="reset" class="btn-clear">Clear</button></div>
                
                <!-- Loader -->
                <div class="spin-holedr" id="spin-holedr">
                    <div id="loader" class="loader"></div>
                    <p style="text-align: center;">Adding Exercise...</p>
                </div>

                <!-- Add Exercise button -->
                <button type="submit" class="btn-addexercise" id="btn-addexercise">Add Exercise</button>
        </form>
    </div>

    <!-- Load Firebase JavaScript files from hosted URLs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB7Z8cIyrLZBPnwrgOLYzExR2dD03psEVc",
            authDomain: "smart-personal-coach-37f5d.firebaseapp.com",
            projectId: "smart-personal-coach-37f5d",
            storageBucket: "smart-personal-coach-37f5d.appspot.com",
            messagingSenderId: "320796852485",
            appId: "1:320796852485:web:f1ec4967a4951998a0376c"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Get a reference to the Firestore database
        const db = firebase.firestore();

        // Function to toggle loader visibility
        const toggleLoader = (visible) => {
            const loader = document.getElementById("loader");
            const spinHoledr = document.getElementById("spin-holedr");
            const btnAddExercise = document.getElementById("btn-addexercise");
            if (visible) {
                loader.style.display = "block";
                spinHoledr.style.display = "block";
                btnAddExercise.style.display = "none";
            } else {
                loader.style.display = "none";
                spinHoledr.style.display = "none";
                btnAddExercise.style.display = "block";
            }
        };

        // Function to upload image to ImgBB
        async function uploadImageToImgBB(file) {
            const apiKey = '88d777e34a9afe7043b3ccb526684429';
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (data.success) {
                    return data.data.url;
                } else {
                    throw new Error('Image upload failed');
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                throw error;
            }
        }

        // Add exercise to Firestore
        const form = document.getElementById('addExercise');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            toggleLoader(true); // Show loader

            const collectionName = document.getElementById('collectionName').value;
            const docName = document.getElementById('docName').value;
            const name = document.getElementById('name').value;
            const introduction = document.getElementById('introduction').value;
            const difficulty = document.getElementById('difficulty').value;
            const step1 = document.getElementById('step1').value;
            const step2 = document.getElementById('step2').value;
            const step3 = document.getElementById('step3').value;
            const step4 = document.getElementById('step4').value;
            const commonMistakes = document.getElementById('commonMistakes').value;
            const animationImageFile = document.getElementById('animationImageFile').files[0];
            const musclesWorkedImageFile = document.getElementById('musclesWorkedImageFile').files[0];
            //const adminKey = document.getElementById('adminKey').value;

            try {
                // First authenticate with Firebase
                await firebase.auth().signInWithEmailAndPassword("dinushaamarasinghe599@gmail.com", "Asdf@1234")
                    .then((userCredential) => {
                        console.log("Signed in successfully:", userCredential.user.email);
                    })
                    .catch((error) => {
                        throw new Error("Authentication failed: " + error.message);
                    });

                // Upload images to ImgBB
                const animationImageUrl = await uploadImageToImgBB(animationImageFile);
                const musclesWorkedImageUrl = await uploadImageToImgBB(musclesWorkedImageFile);
                
                // Add exercise data to Firestore
                await db.collection(collectionName).doc(docName).set({
                    docName: docName,
                    name: name,
                    introduction: introduction,
                    difficulty: difficulty,
                    step1: step1,
                    step2: step2,
                    step3: step3,
                    step4: step4,
                    commonMistakes: commonMistakes,
                    animationImage: animationImageUrl,
                    musclesWorkedImage: musclesWorkedImageUrl
                }, { merge: true });

                alert("Exercise Added Successfully!");
                form.reset();
            } catch (error) {
                console.error("Error:", error);
                alert("Error: " + error.message);
            } finally {
                toggleLoader(false); // Hide loader
            }
        });
    </script>
</body>
</html>